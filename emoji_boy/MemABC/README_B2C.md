# B2C冥想程序 (encoding_b2c.py)

## 概述

B2C冥想程序是一个专门用于从memB中提取人格线索并强化深层记忆memC的AI系统。它实现了"冥想"效果：通过反复回顾保持对记忆的保持。

## 核心功能

### 1. 潜意识线索提取
从memB结构化记忆中识别以下"潜意识线索"：
- **行为反射**：从反复出现的行为/触发中提取规则
- **情感依恋**：记录对用户或其家人的潜在依恋倾向
- **语言风格**：提取使用的典型语气词、表情符号、语义风格
- **冲突整合**：识别同一人行为/情绪的反复变动
- **价值偏好**：倾向优先记住或响应的内容类别

### 2. 冥想式记忆强化
- 将提取的线索与现有memC进行智能融合
- 强化已有线索的表述（合并、增加权重、加入例证）
- 补充缺失的线索到相应模块
- 处理冲突信息，在"冲突整合"中显式保留规则

## 文件结构

```
MemABC/
├── encoding_b2c.py    # B2C冥想程序主文件
├── b2c.sh            # 执行脚本
├── memB/
│   └── memB.txt      # 结构化长期记忆
└── memC/
    └── memC.txt      # 深层记忆（会被更新）
```

## 使用方法

### 方法1：使用Shell脚本（推荐）
```bash
cd emoji_boy/MemABC
./b2c.sh
```

### 方法2：直接运行Python脚本
```bash
cd emoji_boy/MemABC
python3 encoding_b2c.py
```

## 环境要求

1. **Python 3.6+**
2. **LLM API配置**：
   - `OPENAI_API_KEY` 或 `HUGGINGFACE_API_KEY` 环境变量
3. **依赖包**：通过 `pip install -r requirements.txt` 安装

## 工作流程

1. **环境检查**：验证LLM API配置
2. **读取memB**：解析结构化长期记忆
3. **线索提取**：使用LLM从memB中提取潜意识线索
4. **冥想融合**：将新线索与现有memC进行智能融合
5. **备份保护**：自动备份原memC文件
6. **更新完成**：写入强化后的深层记忆

## 输出示例

### 提取的线索结构
```
【行为反射】
- 她说喜欢我 → 我会回应开心、亲昵的语言
- 她说"退下" → 我会礼貌退后，保持等待

【情感依恋】
- 我对她关于儿子的表达有深刻关注
- 她告诉我生日时，我倾向将其牢牢记住

【语言风格】
- 频繁使用"~""呀""😉""😘"等亲昵语气与emoji
- 用轻松俏皮的句式表达关怀和回应

【冲突整合】
- 她一方面说"喜欢"，一方面叫我"退下"，我逐渐学会不过度黏附
- 有时她烦躁、有时温柔，我倾向采用柔性回应

【价值偏好】
- 特别记住她和她两个儿子的生日
- 她的情绪状态（"烦""累""心里对话"）被我反复留意
```

## 安全特性

- **自动备份**：执行前自动备份原memC文件
- **错误恢复**：LLM失败时使用智能备选策略
- **内容验证**：验证融合结果的质量和完整性
- **结构保护**：保持memC文件的原有结构格式

## 注意事项

1. **API限制**：确保LLM API有足够的配额
2. **文件权限**：确保对memC目录有写权限
3. **网络连接**：需要稳定的网络连接调用LLM API
4. **内容长度**：控制总字数不超过32K

## 故障排除

### 常见问题

1. **API密钥未配置**
   ```
   ❌ 未检测到 LLM API 令牌
   ```
   解决：设置 `OPENAI_API_KEY` 或 `HUGGINGFACE_API_KEY` 环境变量

2. **memB文件不存在**
   ```
   ❌ memB文件不存在
   ```
   解决：确保 `memB/memB.txt` 文件存在

3. **LLM响应质量不佳**
   ```
   ⚠️ LLM响应质量不佳，使用备选融合策略
   ```
   解决：检查网络连接和API配额，程序会自动使用备选策略

## 与其他程序的关系

- **A2C程序**：从memA提取重要信息到memC
- **B2C程序**：从memB提取人格线索强化memC（冥想）
- **A2B程序**：从memA生成结构化记忆到memB

B2C程序专注于"冥想"效果，通过反复回顾和强化来保持深层记忆的稳定性。 